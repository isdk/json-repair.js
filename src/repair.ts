import { SchemaWalker } from './walker/index.js';
import { RepairParser } from './parser.js';
import { RepairOptions } from './types.js';

/**
 * Repairs and parses a JSON string generated by an LLM, guided by a JSON Schema.
 * This is the main entry point for the library.
 * 
 * @param input - The potentially broken JSON string to be repaired.
 * @param schema - Either a plain JSON Schema object or a pre-initialized SchemaWalker instance for better performance in batch processing.
 * @param options - Optional configuration to tune the repair process.
 * @returns A promise that resolves to the repaired and parsed JavaScript object.
 * 
 * @example
 * ```typescript
 * const schema = { type: 'object', properties: { name: { type: 'string' } } };
 * const result = await jsonRepair('{ name: John }', schema);
 * console.log(result); // { name: 'John' }
 * ```
 */
export async function jsonRepair(input: string, schema: any | SchemaWalker, options: RepairOptions = {}): Promise<any> {
  const walker = schema instanceof SchemaWalker ? schema : await SchemaWalker.create(schema);
  const parser = new RepairParser(walker, options);
  return parser.parse(input);
}